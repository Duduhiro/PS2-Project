    <!DOCTYPE html>

    <html>

    <head>
        <title>MackDorms - Hóspedes</title>
        <meta charset="UTF-8">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">    </head>
		<link href="./styles/index.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
		<script src="./js/helpers.js"></script>
		<style>
			input[type=number]::-webkit-inner-spin-button,
			input[type=number]::-webkit-outer-spin-button {
				-webkit-appearance: none;
				margin: 0;
			}
			input[type=number] {
				-moz-appearance: textfield;
			}
			body, html {
				height: 100%;
				background-color: #373b3e;
			}
		</style>
	<body class="d-flex flex-column">

		<header class="p-3 ps-3 container-fluid d-flex align-items-center bg-light justify-content-between" style="gap: 20px;" >
			<div class="d-flex align-items-center" style="gap: 20px">
				<h1><a href="./index.html" class="text-reset text-decoration-none">Hotel MackDorms</a></h1>
				<a href="./hospedes.html" class="fs-3 text-secondary text-decoration-none ">Hóspedes</a>
				<a href="./reservas.html" class="fs-3 text-secondary text-decoration-none ">Reservas</a>
			</div>
			<div>
				<button id="signOutButton" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalLogout">
					<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
						<path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
						<path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
					</svg>
					<i class="fas fa-sign-out-alt"></i> Logout
				</button>
			</div>
		</header>

		<div class="modal" tabindex="-1" id="modalLogout">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title">Deseja deslogar?</h4>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
						<button type="button" class="btn btn-primary" onclick="logout()">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
								<path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
								<path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
							</svg>
							Logout
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="container-fluid d-flex flex-column align-items-center ps-0 pe-0 flex-grow-1">
			
			<div class="container-fluid row pt-0 ps-0 pe-0 border-end-0 shadow" style="height: 100%;">
				<div class="col-md-4 pt-3 ps-4 pe-4" style="background-color: #212529;">
					<div class="container text-center text-white">
						<h1>Gerenciamento de hóspedes</h1>
					</div>
					<form class="row mb-4 g-3 needs-validation" novalidate>
						<div class="col-md-2">
							<label for="txtId" class="form-label text-white">ID</label>
							<input type="text" class="form-control text-white btn-outline-secondary" style="background-color: #1a1d20;" id="txtId" required>
						</div>
						<div class="col-md-10">
							<label for="txtNome" class="form-label text-white">Nome</label>
							<input type="text" class="form-control text-white btn-outline-secondary" maxlength="50" oninput="allowOnlyLetters(this)" style="background-color: #1a1d20;" id="txtNome" required>
							<div class="invalid-feedback">
								Insira um nome.
							</div>
						</div>
						<div class="col-md-12">
							<label for="txtEndereco" class="form-label text-white">Endereço</label>
							<input type="text" class="form-control text-white btn-outline-secondary" maxlength="50" oninput="allowOnlyLetters(this)" style="background-color: #1a1d20;" id="txtEndereco" required>
							<div class="invalid-feedback">
								Insira um endereço.
							</div>
						</div>
						<div class="col-md-8">
							<label for="txtEmail" class="form-label text-white">Email</label>
							<input type="email" class="form-control text-white btn-outline-secondary" maxlength="50" oninput="allowOnlyEmails(this)" style="background-color: #1a1d20;" id="txtEmail" required>
							<div class="invalid-feedback">
								Insira um email válido.
							</div>
						</div>
						<div class="col-md-4">
							<label for="txtTelefone" class="form-label text-white">Telefone</label>
							<input type="number" class="form-control text-white btn-outline-secondary" max="999999999999999" min="0" style="background-color: #1a1d20;" id="txtTelefone" required>
							<div class="invalid-feedback">
								Insira um telefone válido.
							</div>
						</div>
						<div class="col-md-12 mt-4 text-center">
							<input type="button" class="btn btn-primary" value="Novo" onclick="novoHospede()" id="btnNovo">
							<input type="button" class="btn btn-success" value="Salvar" onclick="salvarHospede()" id="btnSalvar">
							<input type="button" class="btn btn-danger" value="Apagar" onclick="apagarHospede()" id="btnApagar">
							<input type="button" class="btn btn-warning" value="Cancelar" onclick="cancelarEdicao()" id="btnCancelar">
						</div>
					</form>
					<div class="container text-center text-white">
						<p style="font-weight:bold" id="paragrafoMensagem"></p>
					</div>
					<div class="container text-center text-white mt-5 pt-5">
						<p style="color: #d1d1d1; font-size: 10px;">MackDorms&trade;</p>
					</div>
				</div>
				<div class="col-md-8 ps-0 pe-0" style="overflow-x: auto; max-width: 100%;">
					<table class="table table-dark table-striped">    
						<tr class="table-dark"> 
							<th class="ps-3">ID</th> 
							<th>Nome</th> 
							<th>Endereço</th>
							<th>Email</th>
							<th>Telefone</th> 
						</tr>
						<tbody id="corpoTabelaHospedes"></tbody>
					</table>
				</div>
			</div>
		</div>
        
	    <script>

			var token = localStorage.getItem('token');
			if (!token) {
				window.location.replace("/login.html");
			}

	        const corpoTabela = document.querySelector('#corpoTabelaHospedes');
	        const paragrafoMensagem = document.querySelector('#paragrafoMensagem');
	        const txtNome = document.querySelector('#txtNome');
	        const txtEndereco = document.querySelector('#txtEndereco');
	        const txtEmail = document.querySelector('#txtEmail');
	        const txtTelefone = document.querySelector('#txtTelefone');

	        const txtId = document.querySelector('#txtId');
	        
	        const btnNovo = document.querySelector('#btnNovo');
	        const btnSalvar = document.querySelector('#btnSalvar');
	        const btnApagar = document.querySelector('#btnApagar');
	        const btnCancelar = document.querySelector('#btnCancelar');
	        var criandoNovoHospede = false;
	        
	        inicializar();

	        function inicializar() {
	        	criandoNovoHospede = false;
	            paragrafoMensagem.innerHTML = 'Pressione o botão Novo ou selecione um hóspede da lista:'
	            txtId.value = '';
	            txtNome.value = '';
	            txtEndereco.value = '';
				txtEmail.value = '';
				txtTelefone.value = null;

	            txtId.disabled = true;
	            txtNome.disabled = true;
	            txtEndereco.disabled = true;
				txtEmail.disabled = true;
				txtTelefone.disabled = true;

	            btnNovo.disabled = false;
	            btnSalvar.disabled = true;
	            btnApagar.disabled = true;
	            btnCancelar.disabled = true;
	            listarTodosHospedes();            
	        }

			function validarForm() {
				var form = document.querySelector('form');
				if (form.checkValidity()) {
					return true;
				} else {
					form.classList.add('was-validated');
					return false;
				}
			}

	        async function listarTodosHospedes() {
	            const URL = `/api/hospedes`;
	            fetch(URL, {
					method: 'GET',
					headers: {'Authorization': 'Bearer ' + token}
				})
	              .then(resposta => { if (!resposta.ok) throw Error(resposta.status); return resposta;}) 
	              .then(resposta => resposta.json())
	              .then(jsonResponse => preencherTabela(jsonResponse))
	              .catch(function(error) { paragrafoMensagem.innerHTML = "Erro ao listar hóspedes (código " + error.message + ")";});
	        }
	        
	        
	        function preencherTabela(hospedes) {
	            var linhasTabela = '';
	            var n = hospedes.length;
	            for (var i = 0; i < n; i++) {
	                var f = hospedes[i];
	                linhasTabela += 
	                	`<tr><td class="ps-3"><a href="javascript:void(0)" onclick="selecionarHospede('${f.id}','${f.nome}','${f.endereco}','${f.email}','${f.telefone}')">` 
	                    + f.id     + '</a></td>' + 
	                    '<td style="word-break: break-all;">' + f.nome   + '</td>' +
	                    '<td style="word-break: break-all;">' + f.endereco + '</td>' +
	                    '<td style="word-break: break-all;">' + f.email + '</td>' +
	                    '<td style="word-break: break-all;">' + f.telefone + '</td></tr>\n';
	            }
	            corpoTabela.innerHTML = linhasTabela;
	        }

	        function selecionarHospede(id, nome, endereco, email, telefone) {
	        	criandoNovoHospede = false;
	            paragrafoMensagem.innerHTML = 'Altere e salve os dados do hóspede, ou então apague o registro do hóspede.'
	            txtId.value = id;
	            txtNome.value = nome;
	            txtEndereco.value = endereco;
				txtEmail.value = email;
				txtTelefone.value = telefone;

	            txtId.disabled = true;
	            txtNome.disabled = false;
	            txtEndereco.disabled = false;
	            txtEmail.disabled = false;
	            txtTelefone.disabled = false;

	            btnNovo.disabled = true;
	            btnSalvar.disabled = false;
	            btnApagar.disabled = false;
	            btnCancelar.disabled = false;  
	        }

	        function novoHospede() {
	        	paragrafoMensagem.innerHTML = 'Preencha os dados do novo hóspede...';
	        	criandoNovoHospede = true;
	        	
	        	txtId.value = '';
	        	txtNome.value = '';
	        	txtEndereco.value = '';
				txtEmail.value = '';
				txtTelefone.value = null;
	        	
	        	txtId.disabled = true;
	        	txtNome.disabled = false;
	        	txtEndereco.disabled = false;
				txtEmail.disabled = false;
				txtTelefone.disabled = false;
	        	
	        	btnNovo.disabled = true;
	        	btnSalvar.disabled = false;
	        	btnApagar.disabled = true;
	        	btnCancelar.disabled = false;
	        }
	        
	        function salvarHospede() {

				if(!validarForm()) {
					return;
				}

	        	if (criandoNovoHospede) {
	        		criarHospede();
	        	}
	        	else {
	        		alterarHospede();
	        	}
	        }
	        
	        async function criarHospede() {

	        	const URL = `/api/hospedes`;
	        	const dadosHospede = {
	        		'nome': txtNome.value,
	        		'endereco': txtEndereco.value,
					'email': txtEmail.value,
					'telefone': txtTelefone.value
	        	};
	        	const postRequest = {
	        		method: 'POST',
	        		body: JSON.stringify(dadosHospede),
	        		headers: { 
						'Content-type': 'application/json',
						'Authorization': 'Bearer ' + token
					}
	        	};
	        	fetch(URL, postRequest)
	        		.then(resposta => { if (!resposta.ok) throw Error(resposta.status); return resposta; } )
	        		.then(resposta => resposta.json())
	        		.then(jsonResponse => inicializar())
	        		.catch(function(error) { paragrafoMensagem.innerHTML = 'Erro ao criar novo hóspede (código ' + error.message + ')'; } );
	        }
	        
	        async function alterarHospede() {
	        	const ID = txtId.value;
	        	const URL = `/api/hospedes/${ID}`;
	        	const dadosHospede = {
	        		'id': ID,
	        		'nome': txtNome.value,
	        		'endereco': txtEndereco.value,
					'email': txtEmail.value,
					'telefone': txtTelefone.value
	        	};
	        	const putRequest = {
	        		method: 'PUT',
	        		body: JSON.stringify(dadosHospede),
	        		headers: { 
						'Content-type': 'application/json',
						'Authorization': 'Bearer ' + token
					}
	        	};
	        	fetch(URL, putRequest)
	        		.then(resposta => { if (!resposta.ok) throw Error(resposta.status); return resposta; } )
	        		.then(resposta => resposta.json())
	        		.then(jsonResponse => inicializar())
	        		.catch(function(error) { paragrafoMensagem.innerHTML = 'Erro ao alterar hóspede (código ' + error.message + ')'; } );	        	
	        }
	        
	        function cancelarEdicao() {
	        	inicializar();
	        }
	        
	        async function apagarHospede() {
	        	const ID = txtId.value;
	        	const URL = `/api/hospedes/${ID}`;
	        	const deleteRequest = {
	        		method: 'DELETE',
					headers: {'Authorization': 'Bearer ' + token}
	        	};
	        	fetch(URL, deleteRequest)
	        		.then(resposta => { if (!resposta.ok) throw Error(resposta.status); return resposta; } )
	        		.then(resposta => inicializar())
	        		.catch(function(error) { paragrafoMensagem.innerHTML = 'Erro ao apagar hóspede (código ' + error.message + ')'; } );	        		
	        }
			function logout() {
				localStorage.removeItem('token');
				window.location.replace("/login.html");
			}
	        
	    </script>    
    </body>
    
    </html>

    